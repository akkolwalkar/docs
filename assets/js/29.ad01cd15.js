(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{229:function(e,t,s){"use strict";s.r(t);var n=s(0),a=Object(n.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"sentry-node-architecture"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sentry-node-architecture"}},[e._v("#")]),e._v(" Sentry Node Architecture")]),e._v(" "),s("p",[e._v("This guide provides instructions for a deployment using the Sentry node\narchitecture to protect validator nodes from being directly exposed on the\npublic network.")]),e._v(" "),s("p",[e._v("This guide assumes a setup where an Oasis validator node is only accessible\nover a private network, with sentry nodes having access to it.\nThe guide does not cover setting this infrastructure up.\nKnowledge of "),s("a",{attrs:{href:"https://cosmos.network/docs/cosmos-hub/validators/security.html#sentry-nodes-ddos-protection",target:"_blank",rel:"noopener noreferrer"}},[e._v("Tendermint's Sentry Node architecture"),s("OutboundLink")],1),e._v(" is assumed as\nwell.")]),e._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[e._v("This is only an example of a Sentry node deployment, and we take no responsibility\nfor mistakes contained therein.\nMake sure you understand what you are doing.")])]),e._v(" "),s("h2",{attrs:{id:"prerequisites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),s("p",[e._v("Before following this guide, make sure you've read the "),s("router-link",{attrs:{to:"/operators/prerequisites.html"}},[e._v("Prerequisites")]),e._v(" and\n"),s("router-link",{attrs:{to:"/operators/joining-the-testnet.html"}},[e._v("Joining the Testnet")]),e._v(" guides and created your Entity.")],1),e._v(" "),s("h2",{attrs:{id:"configuring-the-oasis-sentry-node"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuring-the-oasis-sentry-node"}},[e._v("#")]),e._v(" Configuring the Oasis Sentry Node")]),e._v(" "),s("h3",{attrs:{id:"initializing-sentry-node"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#initializing-sentry-node"}},[e._v("#")]),e._v(" Initializing Sentry Node")]),e._v(" "),s("p",[e._v("Sentry node identity keys can be initialized with:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("oasis-node registry node init --entity /localhostdir/entity\n")])])]),s("p",[e._v("The generated "),s("code",[e._v("tls_identity_cert.pem")]),e._v(" (which is the node's TLS cert for\nsecuring gRPC connections) needs to be available on any node that will be\nrunning behind the sentry node.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v("We plan to simplify this step in the future so that it won't involve Entity at\nall since Sentry node's identity keys are in no way linked to the Entity\nitself.\nSee "),s("a",{attrs:{href:"https://github.com/oasislabs/oasis-core/issues/2413",target:"_blank",rel:"noopener noreferrer"}},[e._v("Oasis Core #2413"),s("OutboundLink")],1),e._v(" for\nmore details.")])]),e._v(" "),s("h3",{attrs:{id:"configuring-sentry-node"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuring-sentry-node"}},[e._v("#")]),e._v(" Configuring Sentry Node")]),e._v(" "),s("p",[e._v("An Oasis node can be configured to run as a sentry node by setting the\n"),s("code",[e._v("--worker.sentry.enabled")]),e._v(" flag. Additionally, the\n"),s("code",[e._v("--tendermint.private_peer_id")]),e._v(" flag can be used to configure a list of\nTendermint private peers, which should be set to Tendermint IDs of validator\nnodes, protected by this sentry node.")]),e._v(" "),s("p",[e._v("An example of full "),s("code",[e._v("YAML")]),e._v(" configuration of a sentry node is below.")]),e._v(" "),s("p",[e._v("Before using this configuration you should collect the following information to\nreplace the "),s("code",{pre:!0},[e._v("{{ var_name }}")]),e._v(" variables present in the\nconfiguration file:")]),e._v(" "),s("ul",[s("li",[s("p",[s("code",{pre:!0},[e._v("{{ external_address }}")]),e._v(": This is the external IP you wish to\nuse when registering this node.")])]),e._v(" "),s("li",[s("p",[s("code",{pre:!0},[e._v("{{ seed_node_address }}")]),e._v(": This the seed node address of the\nform "),s("code",[e._v("ID@IP:port")]),e._v(". You can find the current Oasis Seed Node address in the\n"),s("router-link",{attrs:{to:"/operators/current-testnet-parameters.html"}},[e._v("Current Testnet Parameters")]),e._v(".")],1)]),e._v(" "),s("li",[s("p",[s("code",{pre:!0},[e._v("{{ validator_tendermint_id }}")]),e._v(": This is the Tendermint ID of\nthe Oasis validator node that will be protected by the sentry node. This ID\ncan be obtained by running:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("oasis-node debug tendermint show-node-id --datadir /serverdir/node\n")])])]),s("p",[e._v("on the validator node.")])])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Oasis Sentry Node Configuration")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# This file's configurations are derived from the command line args found in the")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# root command of the oasis-node binary. For more information execute:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#     oasis-node --help")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Settings on the command line that are separated by a dot all belong to the")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('# same nested object. So "--foo.bar.baz hello" would translate to:')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#     foo:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#       bar:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#         baz: hello")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Set this to where you wish to store node data. The node artifacts")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# should also be located in this directory (for us this is /serverdir/node)")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("datadir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /serverdir/node\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Logging.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Per-module log levels are defined below. If you prefer just one unified log")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# level, you can use:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# log:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#   level: debug")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("level")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Per-module log levels. Longest prefix match will be taken. Fallback to")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('# "default", if no match.')]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" debug\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("tendermint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" warn\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("tendermint/context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" error\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" JSON\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# By default logs are output to stdout. If you're running this in docker keep")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the default")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#file: /var/log/oasis-node.log")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Path to the genesis file for the current version of the network.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("genesis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /serverdir/etc/genesis.json\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Worker configuration.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("worker")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("sentry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Enable sentry node.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[e._v("true")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Port used by validator nodes to query sentry node for registry")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# information.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# IMPORTANT: Only validator nodes protected by the sentry node should have")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# access to this port. This port should not be exposed on the public")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# network.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("control_port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("9009")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Tendermint backend configuration.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("tendermint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("core")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("listen_address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("//0.0.0.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("26656")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("external_address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("//"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" external_address "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("26656")]),e._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("seeds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{{ seed_node_address }}"')]),e._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Sentry node should set validator IDs as private peer IDs.")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("private_peer_id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{{ validator_tendermint_id }}"')]),e._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v("Multiple sentry nodes can be provisioned following the above steps.")])]),e._v(" "),s("h2",{attrs:{id:"configuring-the-oasis-validator-node"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuring-the-oasis-validator-node"}},[e._v("#")]),e._v(" Configuring the Oasis Validator Node")]),e._v(" "),s("p",[e._v("In this setup the Oasis validator node should not be exposed directly on the\npublic network. The Oasis validator only needs to be able to connect to its\nsentry nodes, preferably via a private network.")]),e._v(" "),s("h3",{attrs:{id:"initializing-validator-node"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#initializing-validator-node"}},[e._v("#")]),e._v(" Initializing Validator Node")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("If your validator node is already registered and running in a non-sentry setup,\nthis step can be skipped as the Oasis validator will update its address in the\nRegistry automatically once we redeploy it with new configuration.")])]),e._v(" "),s("p",[e._v("When you are "),s("router-link",{attrs:{to:"/operators/joining-the-testnet.html#initializing-a-node"}},[e._v("initializing a validator node")]),e._v(", you should use the\nsentry node's external address and Tendermint ID in the\n"),s("code",[e._v("--node.consensus_address")]),e._v(" flag.\nIf you are running multiple sentry nodes, you can specify the\n"),s("code",[e._v("--node.consensus_address")]),e._v(" flag multiple times.")],1),e._v(" "),s("p",[e._v("To initialize a validator node with 2 sentry nodes', run the\nfollowing commands from the "),s("code",[e._v("/localhostdir/node")]),e._v(" directory:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("SENTRY1_CONSENSUS_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("YOUR_SENTRY1_CONSENSUS_ID_HEX"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("SENTRY1_STATIC_IP")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("YOUR_SENTRY1_STATIC_IP"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("SENTRY2_CONSENSUS_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("YOUR_SENTRY2_CONSENSUS_ID_HEX"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("SENTRY2_STATIC_IP")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("YOUR_SENTRY2_STATIC_IP"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\noasis-node registry node init "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --entity /localhostdir/entity "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --node.consensus_address "),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$SENTRY1_CONSENSUS_ID")]),e._v("@"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$SENTRY1_STATIC_IP")]),e._v(":26656 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --node.consensus_address "),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$SENTRY2_CONSENSUS_ID")]),e._v("@"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$SENTRY2_STATIC_IP")]),e._v(":26656 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --node.is_self_signed "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --node.role validator\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[s("code",[e._v("SENTRY_CONSENSUS_ID")]),e._v(": This is the Consensus ID of the sentry node in hex\nformat.\nThis ID can be obtained from "),s("code",[e._v("consensus_pub.pem")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sed")]),e._v(" -n 2p /serverdir/node/consensus_pub.pem "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" base64 -d "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" hexdump -v -e "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/1 \"%02x\" '")]),e._v("\n")])])]),s("p",[e._v("on the sentry node.")])]),e._v(" "),s("h3",{attrs:{id:"configuring-validator-node"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuring-validator-node"}},[e._v("#")]),e._v(" Configuring Validator Node")]),e._v(" "),s("p",[e._v("There are some configuration changes needed for the Oasis validator node to\nenable proxying through its sentry node. Most of these flags should be familiar\nfrom the Tendermint sentry node architecture.")]),e._v(" "),s("p",[e._v("Since the validator node will not have an external address, the\n"),s("code",[e._v("--tendermint.core.external_address")]),e._v(" flag should be skipped. Similarly, the\n"),s("code",[e._v("--tendermint.seed")]),e._v(" flag can be skipped, as the "),s("code",[e._v("oasis-node")]),e._v(" won't be directly\nconnecting to any of the seed nodes.")]),e._v(" "),s("p",[e._v("Tendermint Peer Exchange should be disabled on the validator with the\n"),s("code",[e._v("--tendermint.disable_peer_exchange")]),e._v(" flag.")]),e._v(" "),s("p",[e._v("Sentry nodes should be configured as Tendermint Persistent-Peers with the\n"),s("code",[e._v("--tendermint.persistent_peer")]),e._v(" flag.")]),e._v(" "),s("p",[e._v("In addition to the familiar Tendermint setup above, the node needs to be\nconfigured to query sentry nodes for external addresses every time the validator\npreforms a re-registration. This is configured with "),s("code",[e._v("--worker.sentry.address")]),e._v("\nand "),s("code",[e._v("--worker.sentry.cert_file")]),e._v(" flags.")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("--worker.sentry.address")]),e._v(" flag should be set to the (private) address of\nthe sentry node's control endpoint.")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("--worker.sentry.cert_file")]),e._v(" flag should be set to the sentry node's client\ncertificate (named "),s("code",[e._v("tls_identity_cert.pem")]),e._v(" by default) created when\nprovisioning the sentry node's identity.")]),e._v(" "),s("p",[e._v("Putting it all together, an example configuration of a validator node in the\nsentry node architecture is given below.")]),e._v(" "),s("p",[e._v("Before using this configuration you should collect the following information to\nreplace the "),s("code",{pre:!0},[e._v("{{ var }}")]),e._v(" variables present in the configuration\nfile:")]),e._v(" "),s("ul",[s("li",[s("p",[s("code",[e._v("sentry_node_private_ip")]),e._v(": This is the private IP address of the sentry node\nover which sentry node should be accessible to the validator.")])]),e._v(" "),s("li",[s("p",[s("code",[e._v("sentry_node_certificate")]),e._v(": For each sentry node address, a path to its gRPC\nTLS certificate is required (named "),s("code",[e._v("tls_identity_cert.pem")]),e._v(" by default).")]),e._v(" "),s("p",[e._v("This file is generated when provisioning the sentry node.\nThis certificate needs to be accessible on any node that's connecting to the\nsentry node's control endpoint and is used for securing the communication\nbetween the validator and the sentry node.")])]),e._v(" "),s("li",[s("p",[s("code",[e._v("sentry_node_tendermint_id")]),e._v(": This is the Tendermint ID of the sentry node\nthat will be configured as a Persistent Peer. This ID can be obtained by\nrunning:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("oasis-node debug tendermint show-node-id --datadir /serverdir/node\n")])])]),s("p",[e._v("on the sentry node.")])])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Oasis Node Configuration")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# This file's configurations are derived from the command line args found in")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the root command of the oasis-node binary. For more information execute:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#     oasis-node --help")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Settings on the command line that are separated by a dot all belong to the")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('# same nested object. So "--foo.bar.baz hello" would translate to:')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#     foo:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#       bar:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#         baz: hello")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Set this to where you wish to store node data. The node artifacts")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# should also be located in this directory (for us this is /serverdir/node)")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("datadir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /serverdir/node\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Logging.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Per-module log levels are defined below. If you prefer just one unified log")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# level, you can use:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# log:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#   level: debug")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("level")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Per-module log levels. Longest prefix match will be taken. Fallback to")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('# "default", if no match.')]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" debug\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("tendermint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" warn\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("tendermint/context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" error\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" JSON\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# By default logs are output to stdout. If you're running this in docker keep")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the default")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#file: /var/log/oasis-node.log")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Path to the genesis file for the current version of the network.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("genesis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /serverdir/etc/genesis.json\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Worker configuration.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("worker")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("registration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# In order for the node to register itself the entity.json of the entity")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# used to provision the node must be available on the node.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("entity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /serverdir/node/entity/entity.json\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("sentry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{{ sentry_node_private_ip }}:9009"')]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("cert_file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{{ sentry_node_certificate }}"')]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Consensus backend.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("consensus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Setting this to true will mean that the node you're deploying will attempt")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# to register as a validator.")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("validator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[e._v("True")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Tendermint backend configuration.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("tendermint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("abci")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("prune")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("strategy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" keep_n\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("num_kept")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("86400")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("core")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("listen_address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("//0.0.0.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("26656")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("persistent_peer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{{ sentry_node_tendermint_id }}@{{ sentry_node_private_ip }}:26656"')]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("disable_peer_exchange")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[e._v("True")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("backend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" badger\n")])])])])}),[],!1,null,null,null);t.default=a.exports}}]);
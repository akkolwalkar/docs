<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Handling Network Upgrades | Oasis Dev Docs</title>
    <meta name="description" content="Oasis Developer Documentation">
    <link rel="icon" href="/favicon.ico">
  <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-116576458-1"></script>
  <script>window.dataLayer = window.dataLayer || [];
       function gtag(){dataLayer.push(arguments);}
       gtag('js', new Date());
       gtag('config', 'UA-116576458-1');</script>
  <script>var APP_ID = "scny7003";

       window.intercomSettings = {
         app_id: APP_ID
       };

       function intercom(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/' + APP_ID;var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}};
       intercom();
      </script>
    
    <link rel="preload" href="/assets/css/0.styles.21207d82.css" as="style"><link rel="preload" href="/assets/js/app.2a6813be.js" as="script"><link rel="preload" href="/assets/js/2.29121f01.js" as="script"><link rel="preload" href="/assets/js/25.4ce75248.js" as="script"><link rel="prefetch" href="/assets/js/10.2799fd6a.js"><link rel="prefetch" href="/assets/js/11.08f32702.js"><link rel="prefetch" href="/assets/js/12.768330c2.js"><link rel="prefetch" href="/assets/js/13.c31cde16.js"><link rel="prefetch" href="/assets/js/14.4a361693.js"><link rel="prefetch" href="/assets/js/15.fe0514e5.js"><link rel="prefetch" href="/assets/js/16.588e37d7.js"><link rel="prefetch" href="/assets/js/17.29f6045b.js"><link rel="prefetch" href="/assets/js/18.51b70d53.js"><link rel="prefetch" href="/assets/js/19.db075e67.js"><link rel="prefetch" href="/assets/js/20.a6a0de82.js"><link rel="prefetch" href="/assets/js/21.c454ef73.js"><link rel="prefetch" href="/assets/js/22.374d9ca3.js"><link rel="prefetch" href="/assets/js/23.173112aa.js"><link rel="prefetch" href="/assets/js/24.011bdae0.js"><link rel="prefetch" href="/assets/js/26.5ba10b11.js"><link rel="prefetch" href="/assets/js/27.504340d7.js"><link rel="prefetch" href="/assets/js/28.910cf86b.js"><link rel="prefetch" href="/assets/js/29.ad01cd15.js"><link rel="prefetch" href="/assets/js/3.638a0fa3.js"><link rel="prefetch" href="/assets/js/30.b7774e1d.js"><link rel="prefetch" href="/assets/js/31.cfc0ab6a.js"><link rel="prefetch" href="/assets/js/32.440682da.js"><link rel="prefetch" href="/assets/js/33.d42c9c6b.js"><link rel="prefetch" href="/assets/js/34.0008ea9f.js"><link rel="prefetch" href="/assets/js/35.cca14276.js"><link rel="prefetch" href="/assets/js/36.7bf6dc5f.js"><link rel="prefetch" href="/assets/js/37.74fd0649.js"><link rel="prefetch" href="/assets/js/38.318bd8c8.js"><link rel="prefetch" href="/assets/js/39.65cded1b.js"><link rel="prefetch" href="/assets/js/4.b6ff6971.js"><link rel="prefetch" href="/assets/js/40.bd6b42b4.js"><link rel="prefetch" href="/assets/js/5.018bccb9.js"><link rel="prefetch" href="/assets/js/6.168f4da8.js"><link rel="prefetch" href="/assets/js/7.2faf5023.js"><link rel="prefetch" href="/assets/js/8.6c7668b0.js"><link rel="prefetch" href="/assets/js/9.3d40f8ad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.21207d82.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Oasis Dev Docs" class="logo"> <span class="site-name can-hide">Oasis Dev Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://oasislabs.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://dashboard.oasiscloud.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dashboard
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://join.slack.com/t/oasiscommunity/shared_invite/enQtNjQ5MTA3NTgyOTkzLWIxNTg1ZWZmOTIwNmQ2MTg1YmU0MzgyMzk3OWM2ZWQ4NTQ0ZDJkNTBmMTdlM2JhODllYjg5YmJkODc2NzgwNTg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/oasislabs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://oasislabs.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://dashboard.oasiscloud.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dashboard
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://join.slack.com/t/oasiscommunity/shared_invite/enQtNjQ5MTA3NTgyOTkzLWIxNTg1ZWZmOTIwNmQ2MTg1YmU0MzgyMzk3OWM2ZWQ4NTQ0ZDJkNTBmMTdlM2JhODllYjg5YmJkODc2NzgwNTg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/oasislabs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/overview.html" class="sidebar-link">Overview</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>App Developer Docs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Operator Docs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operators/overview.html" class="sidebar-link">Node Operator Overview</a></li><li><a href="/operators/prerequisites.html" class="sidebar-link">Prerequisites Guide</a></li><li><a href="/operators/joining-the-testnet.html" class="sidebar-link">Joining the Testnet</a></li><li><a href="/operators/creating-an-entity-package.html" class="sidebar-link">Creating an Entity Package</a></li><li><a href="/operators/current-testnet-parameters.html" class="sidebar-link">Current Testnet Parameters</a></li><li><a href="/operators/sentry-node.html" class="sidebar-link">Sentry Node Architecture</a></li><li><a href="/operators/architectural-overview.html" class="sidebar-link">Architectural Overview</a></li><li><a href="/operators/hardware-recommendations.html" class="sidebar-link">Node Hardware Recommendations</a></li><li><a href="/operators/troubleshooting.html" class="sidebar-link">Troubleshooting Guide</a></li><li><a href="/operators/stake-management.html" class="sidebar-link">Stake Management</a></li><li><a href="/operators/incentives-proposal.html" class="sidebar-link">Network Incentives Proposal</a></li><li><a href="/operators/the-quest-rules.html" class="sidebar-link">The Quest Rules</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Maintenance Guides</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operators/maintenance/wiping-node-state.html" class="sidebar-link">Wiping Node State</a></li><li><a href="/operators/maintenance/checking-account-nonce.html" class="sidebar-link">Checking your Account nonce</a></li><li><a href="/operators/maintenance/handling-network-upgrades.html" class="active sidebar-link">Handling Network Upgrades</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/operators/maintenance/handling-network-upgrades.html#dumping-blockchain-state" class="sidebar-link">Dumping Blockchain State</a></li><li class="sidebar-sub-header"><a href="/operators/maintenance/handling-network-upgrades.html#stopping-your-node" class="sidebar-link">Stopping Your Node</a></li><li class="sidebar-sub-header"><a href="/operators/maintenance/handling-network-upgrades.html#patching-dumped-state" class="sidebar-link">Patching Dumped State</a></li><li class="sidebar-sub-header"><a href="/operators/maintenance/handling-network-upgrades.html#wiping-state" class="sidebar-link">Wiping State</a></li><li class="sidebar-sub-header"><a href="/operators/maintenance/handling-network-upgrades.html#upgrading-oasis-core" class="sidebar-link">Upgrading Oasis Core</a></li><li class="sidebar-sub-header"><a href="/operators/maintenance/handling-network-upgrades.html#restarting-the-node" class="sidebar-link">Restarting the Node</a></li><li class="sidebar-sub-header"><a href="/operators/maintenance/handling-network-upgrades.html#cleaning-up" class="sidebar-link">Cleaning Up</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>API Reference</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="handling-network-upgrades"><a href="#handling-network-upgrades" class="header-anchor">#</a> Handling Network Upgrades</h1> <p><em><strong>NOTE: From 19:00 UTC Tuesday, December 17 (2019-12-17T19:00:00Z) to 18:59 UTC
Wednesday, December 18 (2019-12-18T18:59:59Z) the Oasis Testnet will run through
its first coordinated upgrade. Steps on how to upgrade your node during this
window are below.</strong></em></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Following this guide when there is no network upgrade will result in you
losing your place on the current network.</p></div> <p>The following guide should be used when the network has agreed to do a software
upgrade.</p> <h2 id="dumping-blockchain-state"><a href="#dumping-blockchain-state" class="header-anchor">#</a> Dumping Blockchain State</h2> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Do not stop your <code>oasis-node</code> process just yet.</p></div> <p>Before an upgrade we will update the <a href="/operators/current-testnet-parameters.html#upgrade-parameters">Upgrade Parameters</a> to specify the block
height at which to dump.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>You must only run the following command <em>after</em> the <code>HEIGHT_TO_DUMP</code> block
height has been reached on the network.</p></div> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">HEIGHT_TO_DUMP</span><span class="token operator">=</span><span class="token operator">&lt;</span>height_to_dump<span class="token operator">&gt;</span>
oasis-node genesis dump <span class="token punctuation">\</span>
  -a unix:/serverdir/node/internal.sock <span class="token punctuation">\</span>
  --genesis.file /serverdir/etc/upgrade-dump.json <span class="token punctuation">\</span>
  --height <span class="token variable">$HEIGHT_TO_DUMP</span>
</code></pre></div><h2 id="stopping-your-node"><a href="#stopping-your-node" class="header-anchor">#</a> Stopping Your Node</h2> <p>This will depend on your process manager. You should kill your <code>oasis-node</code>
process however this is done for your setup.</p> <h2 id="patching-dumped-state"><a href="#patching-dumped-state" class="header-anchor">#</a> Patching Dumped State</h2> <p>We will provide a state patch in the <a href="/operators/current-testnet-parameters.html#upgrade-parameters">Upgrade Parameters</a> document that you
can apply using the <code>jq</code> tool. We suggest that you install this on your server
so that you can do all the upgrade process without having to transfer anything
onto your local machine. The patched state will update at least the following
fields:</p> <ul><li><code>chain_id</code> - This is the chain ID of the network</li> <li><code>genesis_time</code> - We will set this so that the genesis time is consistent
across all genesis.json files</li> <li><code>halt_epoch</code> - This is the epoch that the node will stop functioning. We set
this to intentionally force an upgrade.</li></ul> <h3 id="downloading-the-patch"><a href="#downloading-the-patch" class="header-anchor">#</a> Downloading the Patch</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">PATCH_URL</span><span class="token operator">=</span><span class="token operator">&lt;</span>url_to_patch<span class="token operator">&gt;</span>
<span class="token function">curl</span> --proto <span class="token string">'=https'</span> --tlsv1.2 -sSL <span class="token variable">$PATCH_URL</span> -o /serverdir/etc/patch.json
</code></pre></div><h3 id="applying-the-patch"><a href="#applying-the-patch" class="header-anchor">#</a> Applying the Patch</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>jq --slurp --sort-keys --compact-output <span class="token string">'.[0] * .[1]'</span> <span class="token punctuation">\</span>
  /serverdir/etc/upgrade-dump.json <span class="token punctuation">\</span>
  /serverdir/etc/patch.json <span class="token operator">&gt;</span> /serverdir/etc/genesis.json
</code></pre></div><h2 id="wiping-state"><a href="#wiping-state" class="header-anchor">#</a> Wiping State</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>We do not suggest that you wipe <em>all</em> state. You might lose node identities and
keys if you do it this way.</p></div> <p>Before restarting your node you should wipe tendermint state. The process for
this is described <a href="/operators/maintenance/wiping-node-state.html#state-wipe-and-keep-node-identity">here</a>.</p> <h2 id="upgrading-oasis-core"><a href="#upgrading-oasis-core" class="header-anchor">#</a> Upgrading Oasis Core</h2> <p>Before starting your node again, make sure you upgrade your <code>oasis-node</code> binary
to the current version specified in the <a href="/operators/current-testnet-parameters.html">Current Testnet Parameters</a>.</p> <h2 id="restarting-the-node"><a href="#restarting-the-node" class="header-anchor">#</a> Restarting the Node</h2> <p>This will depend on your process manager. If you don't have a process manager
you should use one. However, to start the node without a process manager you can
start the <code>oasis-node</code> like so:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node --config /serverdir/etc/config.yml
</code></pre></div><h2 id="cleaning-up"><a href="#cleaning-up" class="header-anchor">#</a> Cleaning Up</h2> <p>After you're comfortable with your node deployment you should clean up the
<code>upgrade-dump.json</code> file. This isn't strictly required, but it is good to keep
your workspace free of unnecessary files.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">rm</span> /serverdir/etc/upgrade-dump.json
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/oasislabs/docs/edit/master/src/operators/maintenance/handling-network-upgrades.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/operators/maintenance/checking-account-nonce.html" class="prev">Checking your Account nonce</a></span> <span class="next"><a href="/operators/maintenance/https://docs.rs/oasis-std">oasis_std</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2a6813be.js" defer></script><script src="/assets/js/2.29121f01.js" defer></script><script src="/assets/js/25.4ce75248.js" defer></script>
  </body>
</html>
